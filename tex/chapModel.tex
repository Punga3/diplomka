\chapter{The limit}
\section{Basic examples}
\subsection{$\mathcal{G}_k=\EDGE_k$}
We consider the classes of graphs
\[\EDGE_k:=\{\text{$(k,E); \abs{E}=1$}\},\]
and we let $\mathcal{G}_k=\EDGE_k$ and $F=F_{tree}$.

Intuitivelly one should not be able to find the edge on a significant i.e. non-infinitesimal fraction of samples with a tree that is allowed to explore only an infinitesimal fraction of edges.

\begin{thrm}\label{thrmedge}
We will prove that \[\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr=\textbf{0}.\]
\end{thrm}
\begin{proof}
Let $T\in F_{tree}$ be a tree of depth $n^{1/t}$, for some $t>\mathbb{N}$ that outputs a pair of numbers less than $n$.

Start from the root of $T$ and always choose the path that corresponds to an edge not existing. At the end we obtain some answer, that gives us a set of at most $2 \cdot n^{1/t}+2$ vertices. Now we can find at least: 
\begin{align}
\binom{n-2n^{1/t}-2}{2}&=\frac{(n-2n^{1/t}-2)(n-2n^{1/t}-3)}{2}
\end{align}
different $\omega\in\Omega$ such that $T(\omega)$ is not an edge in $\omega$. 

The probability that any of those graphs is sampled is
\begin{align}
\frac{\binom{n-2n^{1/t}-2}{2}}{\abs{\mathcal{G}_k}}&=\frac{(n-2n^{1/t}-2)(n-2n^{1/t}-3)}{n(n-1)}\\
&=\left(1-\frac{2n^{1/t}-2}{n}\right)\cdot\left(1-\frac{2n^{1/t}-3}{n-1}\right)\\
&\geq \left(1-\frac{2n^{1/t}-2}{n}\right)^2\\
&\geq 1-\frac{4n^{1/t}-4}{n}.
\end{align}
And one can clearly see that $\st(1-\frac{4n^{1/t}-4}{n})=1$. This proves that the boolean value we are considering is $\textbf{0}$ since we can the two witnesses for $x$ and $y$ into a tree that could find an edge with depth $n^{1/t}$ for some $t>\mathbb{N}$.
\end{proof}

\subsection{Sparse $\mathcal{G}_k$}

One can see that in Theorem \ref{thrmedge} the exact shape of graphs in $\mathcal{G}_k$ does not play a crucial role. If $\mathcal{G}_k$ consisted of all graphs on $k$ verticies containing say exactly one triangle, or any other fixed subgraph of constant size, and no other edges, we would still find that the non-existence is valid in the limit graph.

A more general case would be to consider a family of graphs in which there is an infinitesimally small chance that two independent uniformly random verticies have an edge between. However, this is not sufficient.

\begin{exam}
Let $\mathcal{G}_k$ consist of those graphs on the vertex-set $k$ which contain the edge $E(0,1)$ and then has exactly one other edge. 

As $k$ increases, the number of edges get smaller than any standard positive fraction. But
\[\bbl(\exists x)(\exists y)E(x,y)\bbr=\1,\]
as witnessed by $x$ being the constant $0$ and $y$ the constant $1$ both of which are computable by a tree of depth $0$.
\end{exam}

One can see that having distinguished verticies can ruin the sparseness implying the non-existence of edges in the limit graph. We want to distiguish from this situation by considering the sequences $\mathcal{G}_k$ satisfying the following natural definition.

\begin{defi}
We say that $\{\mathcal{G}_k\}_{k=0}^\infty$ is \textbf{isomorphism closed}, if there is $k_0$ such that for every $k>k_0$ if we have that $G_1\in\mathcal{G}_k$, $V_{G_2}=g_k$ and $G_1\cong G_2$ then $G_2\in\mathcal{G}_k$.
\end{defi}


\begin{thrm}\label{thrmsparse}
Let an isomorphism closed $\mathcal{G}_k$ have the following property. There is a sequence $\{b_k\}_{k}$ and for big enough $k$, a uniformly sampled $2$-element $\{u,v\}\subseteq g_k$ and every $G\in\mathcal{G}_k$ we have
\[\Pr[E_G(u,v)]\leq b_k,\]
and some $k_0$ such that $\lim_{k\to\infty}k^{1/k_0}b_k = 0.$ Then

\[\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr=\0.\]
\end{thrm}
\begin{proof}
Let us define the number $c_{u,v}:=\abs{\{G\in\mathcal{G}_k; E_G(u,v)\}}$, which is the number of graphs $G$ in $\mathcal{G}_k$ satisfying $E_G(u,v)$. Of course $c_{u,u}=0$ for every $u$.

\vspace{0.5em}
\textbf{Claim:} Let $u\neq v,u'\neq v'$ be vertices, then $c_{u,v}=c_{u',v'}$.\\
\textit{proof of claim:} Let $\rho:=(u\:u')(v\:v')$ be a permutation with cycles $(u\:u')$ and $(v\:v')$. We can let $\rho$ act on $\mathcal{G}_k$ by sending $G$ to a graph $\rho(G)$ which renames the edges coordinate-wise.

The fact that $\mathcal{G}_k$ is isomorphism closed implies that $\rho$ restricts to a bijection:
\[\rho':\{G\in\mathcal{G}_k;E_G(u,v), \lnot E_G(u',v')\}\to \{G\in\mathcal{G}_k;E_G(u',v'),\lnot E_G(u,v)\}\]
which proves the claim. \qed
\vspace{0.5em}

Now we define a matrix with entries
\[a_{G,\{u,v\}}:=\begin{cases}1&E_G(u,v)\\0&\text{otherwise}\end{cases}\]
where the rows are indexed by one of $\abs{\mathcal{G}_k}$ many graphs in $\mathcal{G}_k$ and the columns are indexed by the $\frac{k(k-1)}{2}$ many $2$-element sets of numbers in $k$. We take any distinct vertices $u,v$ and define $p:=\Pr_{G\in \mathcal{G}_k}[E_G(u,v)]=\frac{c_{u,v}}{\abs{\mathcal{G}_k}},$ by the claim the choice of $u,v$ does not matter.

The assumption from the statement is equivalent to the equality 
\[\sum_{\{u,v\}}a_{G,\{u,v\}}\leq \frac{k(k-1)}{2}b_k\] 
for every $G$. We combine this with the claim and the definition of $p$ to get
\begin{align}
\frac{k(k-1)}{2}\abs{\mathcal{G}_k}p&=\sum_{\{u,v\}}\sum_{G\in\mathcal{G}_k}a_{G,\{u,v\}}\\
&=\sum_{G\in\mathcal{G}_k}\sum_{\{u,v\}}a_{G,\{u,v\}}\\
&\leq \abs{\mathcal{G}_k}\frac{k(k-1)}{2}b_k
\end{align}
which implies
\[p\leq b_k.\]

Now let $k:=n$ and let $T\in F_{tree}$ be a tree of depth $n^{1/t}$ for some $t>\mathbb{N}$, where every leaf of $T$ is labeled by some edge. Walk down the tree $T$ from the root by answering negatively to every edge, this gives us a set $E_T$ of all edges $T$ inspected or outputed and $\abs{E_T}\leq n^{1/t}+1$.

Now we just need to prove that the probability $T$ find an edge is infinitesimally small. This is enough to prove the theorem, since the trees computing any two witnesses for $x$ and $y$ in the statement can be combined to construct $T$ and if any tree $T$ succeeds with only infinitesimally small probability, no random vertices can witness an edge on a set of non-zero measure.

We use the fact that $p\leq b_n$ to derive 
\begin{align}
\Pr_{G\in\mathcal{G}_n}[T\text{ finds an edge}]&\leq \sum_{\{u,v\}\in E_T} \Pr_{G\in \mathcal{G}_n}[E_G(u,v)]\\
&=\sum_{\{u,v\}\in E_T} \frac{c_{u,v}}{\abs{\mathcal{G}_n}}\\
&\leq\sum_{\{u,v\}\in E_T} p\\
&=(n^{1/t}+1)p\\
&\leq(n^{1/t}+1)b_k\\
&\leq n^{1/k_0}b_k\\
&\approx 0,
\end{align}
which proves the theorem.
\end{proof}

The assumption $\lim_{k\to \infty} k^{1/k_0}b_k=0$ for some $k_0$ may seem unintuitive at first. However, it precisely reflects what is ``sparse" for the trees in $T_{tree}$. The following example shows that without the assumption the theorem fails.

\begin{exam}
Let $\mathcal{G}_k$ consist of all graphs on the vertex set $\set{k}$ with precisely $\lceil\frac{k(k-1)}{2\log k}\rceil$ edges.

Then we claim that
\[\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr=\1.\]

Let $\alpha$ and $\beta$ be verticies computed by the tree of the same shape which inspects a set of any $n^{1/t}$ distinct edges for some $t>\mathbb{N}$. If it finds an edge we define $\alpha$ and $\beta$ in any way so they are the distinct verticies incidental with this edge. Otherwise we let $\alpha(\omega)=\beta(\omega)=0$.

Let $T$ be a tree of the same shape, that computes the pair $\{\alpha,\beta\}$ then we can compute the probability where such a tree fails as the fraction of all graphs which have no edges that $T$ inspects. Let $m=\binom{n}{2}$. We get

\begin{align}
\Pr_{G\in\mathbb{G}_n}[T\text{ fails}]&=\frac{\binom{m-n^{1/t}}{\ceil{ \frac{n(n-1)}{2\log n}} }}{\binom{m}{\ceil{ \frac{n(n-1)}{2\log n}}}}\\
&=\frac{\frac{(m-n^{1/t})!}{\ceil{\frac{n(n-1)}{2\log n}} ! (m-\ceil{ \frac{n(n-1)}{2\log n}}-n^{1/t})!}}{\frac{m!}{\lceil \frac{n(n-1)}{2\log n}\rceil!(m-\ceil{\frac{n(n-1)}{2\log n}})!}}\\
&=\frac{(m-n^{1/t})!(m-\ceil{ \frac{n(n-1)}{2\log n}})!}{m!(m-\ceil{\frac{n(n-1)}{2\log n}}-n^{1/t})!}\\
&=\prod_{i=0}^{n^{1/t}-1}\frac{m-\ceil{\frac{n(n-1)}{2}}-i}{m-i}\\
&=\left(1-\frac{\ceil{\frac{n(n-1)}{2\log n}}}{\frac{n(n-1)}{2}}\right)^{n^{1/t}}\\
&\leq\left(1-\frac{\ceil{\frac{n(n-1)}{2\log n}}}{\frac{n(n-1)}{2}}\right)^{n^{1/t}}\\
&\leq\left(1-\frac{1}{\log n}\right)^{n^{1/t}}
\end{align}

And for any standard $k$ we have
\begin{align}
\left(1-\frac{1}{\log n}\right)^{n^{1/t}}&\leq\left(1-\frac{1}{\log n}\right)^{k\cdot \log n}\\
&\leq (e^{-\frac{1}{\ln 2}})^k.
\end{align}

So $\st(\Pr_{G\in\mathcal{G}_n}[T\text{ fails}])=0$ and we get 
\begin{align}
\mu(\bbl(\exists x)(\exists y)\Gamma(x,y)) \bbr &\geq \mu(\bbl \Gamma(\alpha,\beta)\bbr)\\
&=\st(1-\Pr_{G\in\mathbb{G}_n}[T\text{ fails}])\\
&=1.
\end{align}
\end{exam}

\section{Isomorphism closed $\mathcal{G}_k$}

So far the measure of every truth value we encountered was either $0$ or $1$. Is there a sequence $\mathcal{G}_k$ whose $F_{tree}$-limit and an $\{E\}$-sentence $\varphi$ such that ${0<\bbl\varphi^\Gamma\bbr<1?}$ As in the case of edge existance for a limit of sparse graphs, it is not hard to come up with an example if we allow distiguishing elements in $\mathcal{G}_k$.

\begin{exam}
Let \[\mathcal{G}_k=\{(\set{k},E);\text{$E$ has exactly two edges, one of them being $\{0,1\}$}\},\]

and let $F=F_{tree}$. Then $\mu(\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr)=\frac{1}{2}$.
\end{exam}
\begin{proof}
Let $T_0$ be a tree that always outputs $0$ and $T_1$ be a tree that always outputs $1$. We can prove that $\bbl\Gamma(0,1)\bbr\geq\bbl\Gamma(\alpha,\beta)\bbr$ for any $\alpha,\beta$. 
\end{proof}

For the case of isomorphism closed $\mathcal{G}_k$ we prove that every $\{E\}$-sentence has truth value either $\0$ or $\1$. We start with the existential case.

\begin{exam}
NOT TRUE! Consider all graphs with one edge, or one non-edge. $\mu(\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr)=\frac{1}{2}.$
\end{exam}

\begin{thrm}
Let $\varphi_0(\overline x)$ be an open $\{E\}$-formula, and let $\mathcal{G}_k$ be isomorphism closed and categorical then
\[\bbl(\exists \overline x)\varphi_0^\Gamma(\overline x)\bbr\in\{\0,\1\}.\]
\end{thrm}

\begin{proof}
Let $\overline T$ be a tuple of trees computing $\overline \alpha$ such that 
\[p:=\mu(\bbl\varphi_0(\overline \alpha)\bbr)>\0,\]
moreover we can assume $p<1$ otherwise we are done. We can also assume $\overline T$ is represented just by one tree $T$ which outputs the whole tuple $\overline \alpha$.

We want to iterate $T$ to amplify the probability of success. For every leaf $l$ in $T$ and put 
\[A_l=\{\omega \in \Omega; T(\omega) \text{ ends up at $l$ and } \omega \models \varphi_0(\overline\alpha(\omega)) \}\]
and pick some $G\in A$ and some $G'\in \Omega\setminus A$. From the categoricity we have that there exists a permutation $\rho\in S_{\set{g_n}}$ such that $\rho[G]=G'$.
\end{proof}

\section{Dense $\G_k$}
\begin{thrm}\label{thrmusbv}
Let $\varphi=(\forall \overline x)\varphi_0(\overline x)$ be a universal $\{E\}$-sentence, such that

\[\lim_{k\to\infty}\Pr_{G\in\mathcal{G}_k}(G\models\varphi)=1.\]

Then $\varphi$ is valid in the b.v. structure.


\end{thrm}

\begin{proof}

From $\aleph_1$-saturation of $\mathcal{M}$ and our assumption, we know that for each $m\in\mathbb{N}$ there exists a $k_0\in\mathbb{N}$ such that \[\mathcal{M}\models(\forall k>k_0)\left(\Pr_{G\in\mathcal{G}_k}(G\models \varphi)>1-1/m\right).\]
Therefore, since $n>\mathbb{N}$, we have that $\st(\Pr_{G\in\mathcal{G}_n}(G\models\varphi))=1$ and therefore $\bbl\varphi_0(\overline\alpha)\bbr=\1$ for each tuple $\overline\alpha$ in $F$.

Therefore
\begin{align}
\bbl\varphi\bbr&=\Land_{\overline\alpha}\bbl\varphi_0(\overline\alpha)\bbr\\
&=\Land_{\overline\alpha}\1\\
&=\1.
\end{align}
\end{proof}

\begin{thrm}\label{mutindfind}
Let $F=F_{tree}$. Let $\varphi_0(x_0,\dots,x_{l-1})$ be a q.f. $\{E\}$-formula. Let $0<p\leq 1$, consider subset $A\subseteq[g_k]^l$ such that for all $\overline a \in A$ 

\[\Pr_{G\in\mathcal{G}_k}(G\models \varphi_0(\overline a))\geq p\]

and

\[\text{$\{\{G\models\varphi_0(\overline a)\}\subseteq \mathcal{G}_k;\overline a \in A\}$ are mutually independent.}\]
moreover let $A_k$ be the set with the largest cardinality that  has this property.

If $\lim_{k\to\infty} \abs{A_k}=\infty$, then $\bbl(\exists \overline x)\varphi_0(\overline x)\bbr=\1$.
\end{thrm}

\begin{proof}
Let $\overline x = (x_0,\dots,x_{l-1})$. Let $T_{\overline a}$ be a tree of some standard depth $d$, that tests whether $G\models\varphi_0(\overline a)$.

From $\aleph_1$-saturation of $\mathcal{M}$ we have $n'>\mathbb{N}$ many tuples \(\overline a_0,\dots,\overline a_{n'-1}\in A_n\), such that \(\Pr_{G\in\mathcal{G}_k}(G\models\varphi_0(\overline a_i))\geq p\), we can assume $n'<n^{1/t_0}$ for some $t_0>\mathbb{N}$.


For $j\in[l]$ construct a tree $T_j$ inductively as follows: Start with $T_{\overline a_0}$. Replace the label of every accepting leaf by $(\overline a_0)_j$ and remove the label of every rejecting leaf. Call this tree $T_j^0$. Assume we have already constructed $T_j^{m}$. Construct $T_j^{i+1}$ by appending $T_{\overline a_{m+1}}$ to every undefined leaf, relabeling every satisfied leaf to $(\overline a_{i+1})_j$ and removing labels from every rejecting leaf. We will define $T_j$ as $T_j^{n'}$ with undefined leafs labeled by $0$. (This can be done, because all instances of induction are in $\Th(\mathbb{N})$.) Note that $\dpt(T_j)=d\cdot n' < n^{1/t}$ for some $t>\mathbb{N}$. 

Call $\overline \alpha$ the tuple computed by $T_0,\dots,T_{l-1}$. We will prove that probability of $\overline \alpha$ being a witness to $\varphi_0(\overline x)$ is 1. For each $\overline a_i$ we have, that the probability of $G\models\varphi_0(\overline a_i)$ is at least $p$. The mutual independence of ${\{G\models\varphi_0(\overline a_i);i\in[n']\}}$ and the construction of $T_j$ implies that $T_j$ has a probability of $(1-p)^{n'}$ of failing, which is obviously almost $0$.
\end{proof}

\begin{exam}
Let \[\mathcal{G}_k=\{([k],E);\text{$E$ at least one edge, and may have exactly $k/2$ more from start}\}\]

and let $F=F_{tree}$. Then $\mu(\bbl(\exists x)(\exists y)\Gamma(x,y)\bbr)=\frac{1}{2}$.
\end{exam}


\section{$\mathcal{G}_k=\text{ALL}_k$}

\begin{thrm}[Everything exists]
Let $\varphi(\overline x,\overline y)=\Land_{i=0}^{m-1}\psi_i(\overline x,\overline y)\land \Land_{i=0}^{l-1}\vartheta_i(\overline y)$, where $\psi_i,\vartheta_i$ are literals and $\psi_i$ are not of the form $(y_i=y_j)^b$, $E(y_i,y_j)^b$, $x_i\not= x_i$, $E(x_i,x_i)$, $b\in\{0,1\}$.

Let $\overline \beta$ be a tuple of vertices computed by $F_{tree}$ of the same length as $\overline y$. Then $\bbl(\exists \overline x)\varphi^\Gamma(\overline x,\overline \beta)\bbr=\bbl\Land_{i=0}^{l-1}\vartheta_i(\overline \beta)\bbr$, specifically if $l=0$ then $(\exists \overline x)\phi_0(\overline x,\overline \beta)$ is valid in the b.v. graph.
\end{thrm}
\begin{proof} We will construct one tree $T$ computing the whole tuple of witnesses $\overline \alpha$, such a construction can be straightforwardly split into a tuple of tree each computing the specific element.

First we concatenate all the trees used to compute $\overline \beta$. At each leave we can now proceed knowing the value of $\overline \beta$ at the specific $\omega\in\Omega$. Now we just construct a tree as in Theorem \ref{mutindfind} but searching only over edges not checked previously and only to fulfill each $\psi_i$. Luckily we have so far searched only an infinitesimal part of the edges and since we assume $\mathcal{G}_k=\text{ALL}_k$ both of the conditions of the theorem are satisfied, so by analogous argument, we have a tree that finds a witness all of the $\psi_i(\overline x,\overline \beta)$ with probability infinitesimally close to 1.

Therefore
\begin{align}
\bbl(\exists \overline x)\varphi^\Gamma(\overline x,\overline \beta)\bbr&=\bbl(\exists \overline x)\Land_{i=0}^{m-1}\psi_i(\overline x,\overline \beta)\bbr \land \bbl\Land_{i=0}^{l-1}\vartheta_i(\overline \beta)\bbr\\
&=\bbl\Land_{i=0}^{l-1}\vartheta_i(\overline \beta)\bbr.
\end{align}
\end{proof}

\begin{crll}
For each $\varphi(\overline x)$ that is not a tautology in the theory of graphs we have that $\bbl(\forall \overline x)\varphi^\Gamma(\overline x)\bbr=\0$.
\end{crll}
\begin{crll}
For each $\varphi(\overline x,\overline y)$ that is not falsifiable by $\overline y$ in the theory of graphs we have that $\bbl(\forall \overline y)(\exists \overline x)\varphi^\Gamma(\overline x)\bbr=\1$.
\end{crll}
