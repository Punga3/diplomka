\chapter{Forcing with random variables and the wide Limit}\label{chapwidelimit}
\section{Setup}

Our goal in this chapter is to provide a definition of a limit of a set an infinite set of finite graphs in which arbitrarily large graphs occur. The following definition makes our requirements of such a class of graphs precise. From now on $E$ denotes a binary relational symbol, so that formulas in the theory of graphs are precisely $E$-sentences.

\begin{defi}
Let $\{\mathcal{G}_k\}_{k>0}$ be a sequence of non-empty finite sets of (directed or undirected) finite graphs, i.e. structures of in the first order language consisting of the binary function $\{E\}$. We call it a \textbf{wide sequence} if the following holds.

\begin{itemize}
\item There is an increasing sequence of positive whole numbers $\{g_k\}_{k>0}$ such that the underlying set of each $G\in\mathcal{G}_k$ is $\set{g_k}$.
\item $\lim_{k\to\infty} \abs{\mathcal{G}_k}=\infty$
\end{itemize}
\end{defi}

The second condition guarantees that $\mathcal{G}_n$ is an infinite set for $n>\mathbb{N}$. In fact, the condition is not strictly important to proceed with this chapter, but it more closely describes what sort of sequences we are interested in. Many interesting classes of graphs form a wide sequence if we restrict the vertex-sets to $\set{g_k}$, where $\{g_k\}_{k>0}$ can be taken as the increasing sequence of all cardinalities in such a class. For example graphs with exactly one edge, graphs with bounded degree and so on. We will get to explore many examples in depth after we define the wide limit.

(TODO: wide sequence <-> class of structures)

 The limit is defined by specifying a nonstandard prolongation $\{G_n\}_{n<t}$ of the original wide sequence, non standard n < t and a certain Boolean valued extension $K(F)$ of $\cal M$. 

When the original sequence is definable in N (as it is always the case in this
thesis) then we can take for the prolongation the sequence defined
in the same way in M (and it is, in fact, also unbounded); hence
we will not refer explicitly to the choice of the prolongation.

On $K(F)$ we define a particular binary Boolean valued relation
$\Gamma$ (depending on n). Our aim is to relate first-order properties
of $\Gamma$ to various combinatorial and complexity-theoretic
properties of the wide sequence. In this case we shall talk about 
first order limit.

 We shall be also interested in second order properties of $\Gamma$,
for example the existence of a large clique. For this we expand
$K(F)$ to $K(F,G)$ with $G$ being second order objects (relations, functions).
In this case we shall talk about second order limit.

 

\section{The first order wide limit}

From now on we closely follow Chapter 1 of \cite{krajicek2010forcing}. Let $\mathcal{M}$ be the $\aleph_1$-saturated model of true arithmetic discussed in the previous chapter and let $\mathcal{G}_k$ be a wide sequence of graphs and $\Omega:=\mathcal{G}_n$ for $n\in\mathcal{M}\setminus \mathbb{N}$. One can check that graphs in $\Omega$ are all pseudofinite. The model $\M$ treats all its elements (including those which represent sets) as ``finite objects'' which lets us define uniform probability even on sets which are infinite from the set-theoretical perspective. We provide the definition generally for any $L$-reduct of $\M$, where $L\subseteq L_{all}$, but in the rest of the thesis we assume $L=L_{all}$ even though some finite sublanguage would suffice.


\begin{defi}
Let $\mathcal{A}:=\{A\in\mathcal{M};A\subseteq \Omega\}$ be the set of all subsets of $\Omega$ represented by an element in $\M$.

We define the \textbf{counting measure} as the uniform probability of $A$ when we sample $\Omega$ uniformly, so we have
\[A\in\A \to \abs{A}/\abs{\Omega},\]
the counting measure takes values in $\M$-rationals.
\end{defi}

One can check that $\A$ is a Boolean algebra, but not a $\sigma$-algebra as it is not closed under all countable unions. Indeed all singleton sets are part of $\A$ but the set of all elements with standardly many predecessors in $\Omega$ is not in $\A$.

\begin{defi}\label{defiinfinitesimal}
We call an $\M$-rational \textbf{infinitesimal} if it is smaller than all standard fractions $\frac{1}{k},k\in\N$.

Define an ideal in $\A$ as $\I:=\{A\in\A;\abs{A}/\abs{\Omega}\text{ is infinitesimal}\}$. Define the boolean algebra $\B:=\A/\I$. The induced measure on $\B$ is a real-valued measure and can be written as \[\mu(A/\I)=\st(\abs{A}/\abs{\Omega}).\]
\end{defi}

We can also check, that now $\mu$ is a measure in the ordinary sense and that $\B$ is an $\sigma$-algebra. In fact, the following key lemma holds.

\begin{lemm}
$\B$ is a complete boolean algebra.
\end{lemm}

We now define what we require of the family of functions $F$ we already mentioned.

\begin{defi}
Let $F$ be a non-empty set of $\M$-finite function which are elements in $\M$. We call it a \textbf{random vertex family} if it satisfies the following:
\begin{itemize}
\item The domain of any function $\alpha\in F$ is $\Omega$ and the range is $\set{g_n}$.
\end{itemize}
\end{defi}

Note that while every $\alpha\in F$ is represented by some element in $\M$, this need not be the case for the whole family $F$. From now on $\Gamma$ denotes a binary relational symbol which we understand as `limit edge relation'. For a $\{E\}$-formula $\varphi$ we denote its translation to a $\{\Gamma\}$-formula by rewriting every $E$ to $\Gamma$ as $\varphi^{\Gamma}$.

Now we can finally define the first order wide limit.

\begin{defi}
We define a $\B$-valued $\Gamma$-structure $\lim_{k\to n}^{F}G_k$, where $\Gamma$ is a binary relation symbol, with universe $F$ and $\Gamma$-sentences being evaluated by the following inductive conditions:
\begin{itemize}
\item $\bbl \alpha=\beta \bbr := \{\omega\in\Omega; \alpha(\omega)=\beta(\omega)\}/\I.$
\item $\bbl \Gamma(\alpha,\beta) \bbr := \{\omega\in\Omega; E_\omega(\alpha,\beta))\}/\I$.
\item $\bbl-\bbr$ commutes with $\land$,$\lor$,$\lnot$.
\item $\bbl(\exists x)A(x)\bbr:=\Lor_{\alpha\in F}\bbl A(\alpha)\bbr$.
\item $\bbl(\forall x)A(x)\bbr:=\Land_{\alpha\in F}\bbl A(\alpha)\bbr$.
\end{itemize}

By abuse of notation we will usually denote the limit $\lim_{F}\G_n$.
\end{defi}

We will also define the structure $K(\G_n,F)$ which is not important in the second order case, but makes the definition of its second order counterpart more manageable. 


\begin{defi}
$K(\G_n,F)$ will denote a $\B$-valued $L_{rel}\cup\{\Gamma\}$-structure defined as an $L_{rel}\cup\{\Gamma\}$-expansion of $\lim_F\G_n$. The boolean evaluations of atomic $L$-sentences are defined by the following inductive rules:

\begin{itemize}
\item $\bbl R(\alpha_1,\dots,\alpha_k) \bbr := \{\omega\in\Omega; R(\alpha_1,\dots,\alpha_k)\}/\I$ for any $k$-ary $R\in L_{rel}$.
\end{itemize}
\end{defi}


\section{The second order wide limit}

While we can find a truth value of a sentence in the language of graphs in the limit $\lim_{F}\G_n$, we will encounter situations where this is not sufficient to analyze the wide sequence $\{\G_k\}_{k>0}$. 

In Chapter \ref{chapdense} we will investigate how the existence of large cliques corresponds to the size of cliques in the limit graph. First we need some way to witness subsets of vertices -- this leads us to the second order wide limit. However, in the second order case the underlying arithmetic is much more important because we cannot just measure the set-theoretical cardinality of any such clique. For specific $n$ we could very well have $\card(\set{\floor{\log{n}}})=\card(\set{\floor{\frac{n}{2}}})$ but from the point of view of complexity theory, cliques of size $\floor{\log n}$ and $\floor{\frac{n}{2}}$ are dramatically different. In other words, our goal is also to have means to count the number elements of subsets or relations with values in (random variables in) $\M$.

When we say second order we mean two-sorted first order structures where one sort represents the usual elements (the `first order' sort) and the other represents functions on those elements (the `second order' sort). The `second order' here can also represent sets and relations by \{0,1\} valued functions.

\begin{defi}
We call a set of functions $G\subseteq \M$ an $F$-compatible \textbf{functional family} if every $\Theta\in G$ assigns to every $\omega\in\Omega$ a function $\Theta_\omega\in\M$ and after we define
\[\Theta(\alpha)(\omega):=
\begin{cases}\Theta_\omega(\alpha(\omega))&\alpha(\omega)\in\dom(\Theta_\omega)\\0&\text{otherwise,}
\end{cases}\]
we have that for every $\alpha \in F$ and $\Theta \in G$ we have $\Theta(\alpha)\in F$.

We call $\Theta\in G$ a (graph) $G$-\textbf{relation} if for every $\omega\in\Omega$ we have for some $k>0$ that $\dom \Theta_\omega \supseteq \set{g_n}^k$ and $\Theta_\omega:\dom \Theta_\omega \to \{0,1\}$.
\end{defi}

\begin{defi}
Let $F$ be a vertex family and $G$ be an $F$-compatible functional family. We define the structure $K(\G_n,F,G)$ as a two sorted $L$-structure with sorts $F$ and $G$ interpreting $L_{rel}$-sentences as $K(\G_n,F)$ and treating the sort $G$ as follows. First for equality we let
\[\bbl\Theta=\Xi \bbr := \{\omega\in \Omega;\Theta_\omega=\Xi_\omega\}/\I\]
and for the second order quantifiers we have the following inductive clauses
\begin{itemize}
\item $\bbl(\exists X)A(X)\bbr:=\Lor_{\Theta\in G}\bbl A(\Theta)\bbr$
\item $\bbl(\forall X)A(X)\bbr:=\Land_{\Theta\in G}\bbl A(\Theta)\bbr.$
\end{itemize}

We define \textbf{the second order wide limit} $\lim_{F,n}^G\{\G_k\}_{k>0}$ as $\{\Gamma\}$-reduct of $K(\G_n,F,G)$. By abuse of notation we will mostly denote it $\lim_F^G\G_n$.

(TODO: Terms)
\end{defi}

Let us note that if we have multiple boolean valued structures $\A_1,\A_2,\dots$ we may add the name of the structure as a prefix to the evaluation function to get $\A_1\bbl-\bbr$ and $\A_2\bbl-\bbr$ to avoid ambiguity or to emphasize the structure where the evaluation takes place. This is different from the standard notation, which would be including the structure name in the superscript as $\bbl\dots\bbr^{\A_1}$, but it is in our case preferable for typographical reasons.
 
\section{The vertex family $F_{rud}$ and $G_{rud}$}\label{secFrud}

Throughout this thesis we will mostly work with the vertex family $F_{rud}$ which ties the properties of $\lim_F \G_n$ with decision tree complexity -- but decision trees can also be seen as an abstraction of oracle machine time we mentioned in the Introduction.

After we choose the sequence $\{\G_k\}_{k>0}$ and $n>\N$ we again put $\Omega:=\G_n$ and define $F_{rud}$ as follows.

\begin{defi}
We define a \textbf{decision tree} to be a binary tree $T\in\M$ with a labeling of vertices and edges $\ell$. The non-leaf vertices are labeled by pairs of numbers $(u,v)$, where $u,v\in\set{g_n}$ and each edge is labeled either by $1$ or $0$. Each leaf vertex is then labeled by some element of $\M$.

Every sample $\omega\in\Omega$ uniquely determines a path in $(T,\ell)$ by interpreting the vertex labels as ``is $(u,v)\in E_\omega$?'' and the edge labels as true $(1)$ and false $(0)$ and the path then uniquely determines an output.

We define $F_{rud}$ to be the set of all functions computed by some $(T,\ell)$ of depth at most $g_n^{1/t}$.
\end{defi}

%Note that if we are given a graph $G\in G_k$ on $g_k$ vertices, we need $l:=2\log g_n$ bits to represent it. In the pseudofinite case, $k=n$, if we are restricted to inspect/query at most $g_n^{1/t}$ edges then it corresponds to $2^{O(l/t)}$ many queries or the subexponential oracle time.

One can verify that $F_{rud}$ is an vertex family for any $L\subseteq L_{all}$.

The definition of $G_{rud}$ is a bit more involved. The functionals in it will be computed by tuples of elements from $F_{rud}$ in the following sense.

\begin{defi}
Let $\hat\beta=(\beta_0,\dots,\beta_{m-1})\in\M$ be a $m$-tuple of elements in $F_{rud}$, for any $\alpha\in F_{rud}$ and $\omega\in\Omega$ we define
\[\hat\beta(\omega)=
\begin{cases}
\beta_{\alpha(\omega)}(\omega)&\alpha(\omega)<m\\
0&\text{otherwise.}
\end{cases}\]
\end{defi}

\begin{defi}
The family $G_{rud}$ consists of all functionals $\Theta$ such that there is $m\in\M$ and some $\hat \beta=(\beta_0,\dots,\beta_{m-1})\in\M$ that computes it.
\end{defi}

\begin{lemm}
$G_{rud}$ is $(F_{rud})$-compatible.
\end{lemm}
\begin{proof}
By induction in $\M$ we have that all the depth of all the trees is bounded by $g_n^{1/t}$ for some $t>\N$.

If we take some $\Theta\in G_{rud}$ and $\alpha\in F_{rud}$ we can compute $\Theta(\alpha)$ also by a tree in $F_{rud}$ by concatenating the trees computing $\alpha$ and $\beta_i$s.
\end{proof}

\section{Different choices of $n$}

Even though we generally pose no requirements on $n>\N$ there are examples of wide sequences for which the limit is sensitive on the choice of the non-standard number $n$.

\begin{exam}
Let 

\[\
G_{k}:=
\begin{cases}
\{(\set{k},E);\abs{E}=2,E(0,1)\}&\text{$k$ even}\\
\{(\set{k},E);\abs{E}=1,\lnot E(0,1)\}&\text{$k$ odd.}\\
\end{cases}\]

Let $n>\N$ then
\begin{align}
\lim_{F_{rud}}\G_{2n+1} \bbl \Gamma(0,1)\bbr =\0,
\end{align}
but
\begin{align}
\lim_{F_{rud}}\G_{2n}\bbl \Gamma(0,1)\bbr=\1.
\end{align}

Even though the concrete wide limits we will investigate in the following chapters do not depend on the specific $n$, it is important to note that we cannot generally remove the parameter $n$ from the definition of the limit.
\end{exam}

\section{Theories of wide limits}

If $\lim_F\G_n$ is the first order wide limit we will be interested in which exact $\{\Gamma\}$-sentences are valid in it. By \textbf{valid} we mean that their $\bbl\dots\bbr$ value is $\1$.

\begin{defi}
We define $\Th(\lim_F\G_n)$ as the set of all valid $\Gamma$-sentences in $\lim_{F}\G_n$.
\end{defi}

In the next chapter (Theorem \ref{thrmuni}) we will see that if a universal $\{E\}$-sentence $\varphi$ holds for all $G\in\G_k$ for $k$ big enough then $\lim_F\G_n\bbl\varphi^\Gamma\bbr=\1$. In particular, a wide limit of undirected graphs in a boolean valued undirected graph and a wide limit of directed graphs is a boolean valued directed graph.

Lastly, let us recall the concept of 0-1 laws which say that a certain probability tends either to $0$ or $1$ and not to any intermediate value. Here, instead of probability, we can think about the boolean values $\0$ and $\1$ and ask when does it happen that $\lim_F\G_n\bbl\varphi\bbr\in\{\0,\1\}$ for every $\{\Gamma\}$-sentence $\varphi$. This is exactly equivalent to the situation where the theory $\Th(\lim_G \G_n)$ is complete. Later in the thesis we prove such 0-1 law for several wide limits.
